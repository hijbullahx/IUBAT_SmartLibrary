<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IUBAT Smart Library System</title>
    <style>
        body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;margin:0}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.admin-dashboard{padding:20px;text-align:center}.admin-header{display:flex;justify-content:flex-end;margin-bottom:20px}.report-section{margin-top:30px}.report-section form{align-items:center;display:flex;gap:10px;justify-content:center;margin-bottom:20px}.report-table{border-collapse:collapse;margin-top:20px;width:100%}.report-table td,.report-table th{border:1px solid #ddd;padding:8px;text-align:left}.report-table th{background-color:#f2f2f2}.status-message{color:#555;font-style:italic}*{box-sizing:border-box;margin:0;padding:0}body{background:linear-gradient(135deg,#667eea,#764ba2);color:#333;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.App,body{min-height:100vh}.App{display:flex;flex-direction:column}.header{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#fffffff2;box-shadow:0 4px 20px #0000001a;padding:1rem 0;position:sticky;top:0;z-index:100}.header-content{flex-wrap:wrap;justify-content:space-between;margin:0 auto;max-width:1200px;padding:0 2rem}.header-content,.logo-title{align-items:center;display:flex}.logo-title{gap:1rem}.iubat-logo{height:50px;object-fit:contain;width:50px}.header h1{color:#2c3e50;font-size:1.8rem;font-weight:700}.nav-buttons{display:flex;gap:1rem}.nav-buttons button{background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:25px;color:#fff;cursor:pointer;font-size:.9rem;font-weight:600;padding:.75rem 1.5rem;transition:all .3s ease}.nav-buttons button:hover{box-shadow:0 8px 25px #667eea66;transform:translateY(-2px)}.nav-buttons button.active{background:linear-gradient(135deg,#2c3e50,#34495e);box-shadow:0 8px 25px #2c3e5066;transform:translateY(-2px)}.main-content{flex:1 1;margin:0 auto;max-width:1200px;padding:2rem;width:100%}.main-library{grid-gap:2rem;display:grid;gap:2rem;grid-template-columns:1fr}.entry-section{background:#fffffff2;border-radius:20px;box-shadow:0 10px 40px #0000001a;padding:2rem;text-align:center}.entry-section h2{color:#2c3e50;font-size:2rem;font-weight:700;margin-bottom:1rem}.description{color:#7f8c8d;line-height:1.6}.entry-form{margin-bottom:2rem}.input-group{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;margin-bottom:1rem}.student-input{background:#fff;border:2px solid #e0e6ed;border-radius:12px;font-size:1.1rem;padding:1rem 1.5rem;transition:all .3s ease;width:300px}.student-input:focus{border-color:#667eea;box-shadow:0 0 20px #667eea33;outline:none;transform:translateY(-2px)}.submit-btn{background:linear-gradient(135deg,#27ae60,#2ecc71);border:none;border-radius:12px;color:#fff;cursor:pointer;font-size:1.1rem;font-weight:600;min-width:120px;padding:1rem 2rem;transition:all .3s ease}.submit-btn:hover{box-shadow:0 8px 25px #27ae6066;transform:translateY(-2px)}.message{animation:slideIn .5s ease;border-radius:12px;margin:2rem 0;padding:1.5rem;text-align:center}.message.success{background:linear-gradient(135deg,#d4edda,#c3e6cb);border:2px solid #c3e6cb;color:#155724}.message.warning{background:linear-gradient(135deg,#fff3cd,#ffeaa7);border:2px solid #ffeaa7;color:#856404}.message.error{background:linear-gradient(135deg,#f8d7da,#f5c6cb);border:2px solid #f5c6cb;color:#721c24}.message.info{background:linear-gradient(135deg,#d1ecf1,#bee5eb);border:2px solid #bee5eb;color:#0c5460}.message-content h3{font-size:1.3rem;margin-bottom:.5rem}.action-badge{border-radius:20px;display:inline-block;font-size:.9rem;font-weight:700;margin-top:.5rem;padding:.5rem 1rem}.action-badge.login{background:#27ae60;color:#fff}.action-badge.logout{background:#f39c12;color:#fff}.quick-test-section{background:#fffffff2;border-radius:20px;box-shadow:0 10px 40px #0000001a;padding:2rem}.quick-test-section h3{color:#2c3e50;font-size:1.5rem;margin-bottom:1.5rem;text-align:center}.sample-students{grid-gap:1rem;display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}.student-btn{background:#fff;border:2px solid #e0e6ed;border-radius:12px;cursor:pointer;display:flex;flex-direction:column;gap:.5rem;padding:1rem;text-align:left;transition:all .3s ease}.student-btn:hover{border-color:#667eea;box-shadow:0 8px 25px #667eea33;transform:translateY(-2px)}.student-id{color:#667eea;font-size:1.1rem;font-weight:700}.student-name{color:#2c3e50;font-size:.95rem}.stats-section{background:#fffffff2;border-radius:20px;box-shadow:0 10px 40px #0000001a;padding:2rem}.stats-section h3{color:#2c3e50;font-size:1.5rem;margin-bottom:1.5rem;text-align:center}.stats-grid{grid-gap:1.5rem;display:grid;gap:1.5rem;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.stat-card{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;flex-direction:column;gap:.5rem;padding:1.5rem}.stat-emoji{font-size:2rem}.stat-label{font-size:.9rem;opacity:.9}.stat-value{font-size:1.8rem;font-weight:700}.elibrary-container{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;min-height:100vh;padding:2rem}.elibrary-error,.elibrary-loading{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border-radius:15px;margin:2rem auto;max-width:500px;padding:3rem;text-align:center}.retry-btn{background:#ff6b6b;border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:600;margin-top:1rem;padding:.7rem 1.5rem;transition:all .3s ease}.retry-btn:hover{background:#ff5252;transform:translateY(-2px)}.description{font-size:1.1rem;margin-bottom:2rem;opacity:.9}.pc-list{grid-gap:1rem;display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));margin-top:1.5rem}.pc-card{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffff26;border:2px solid #0000;border-radius:12px;cursor:pointer;padding:1.5rem;text-align:center;transition:all .3s ease}.pc-card:hover{box-shadow:0 10px 25px #0003;transform:translateY(-5px)}.pc-card.available{background:linear-gradient(135deg,#4caf504d,#4caf501a);border-color:#4caf50}.pc-card.available:hover{background:linear-gradient(135deg,#4caf5066,#4caf5033)}.pc-card.in-use{background:linear-gradient(135deg,#f443364d,#f443361a);border-color:#f44336;cursor:not-allowed}.pc-card.dumb{background:linear-gradient(135deg,#9e9e9e4d,#9e9e9e1a);border-color:#9e9e9e;cursor:not-allowed;opacity:.6}.pc-card.selected{background:linear-gradient(135deg,#ffeb3b66,#ffeb3b33);border-color:#ffeb3b;box-shadow:0 0 20px #ffeb3b80}.pc-card h3{color:#fff;font-size:1.2rem;margin:0 0 .5rem}.pc-management{grid-gap:2rem;display:grid;gap:2rem;grid-template-columns:2fr 1fr;margin-top:2rem}.pc-status-section{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border:1px solid #fff3;border-radius:15px;padding:2rem}.pc-status-section h3{align-items:center;color:#fff;display:flex;gap:.5rem;margin-bottom:1rem}.action-section{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border:1px solid #fff3;border-radius:15px;height:fit-content;padding:2rem}.action-section h3,.action-section h4{color:#fff;margin-bottom:1rem}.action-toggle{background:#ffffff1a;border-radius:10px;display:flex;gap:.5rem;margin-bottom:1.5rem;padding:.5rem}.toggle-btn{background:#ffffff1a;border:none;border-radius:8px;color:#fff;cursor:pointer;flex:1 1;font-weight:600;padding:.8rem 1rem;transition:all .3s ease}.toggle-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);box-shadow:0 5px 15px #0003;transform:translateY(-2px)}.toggle-btn:hover{background:#fff3}.toggle-btn.active:hover{background:linear-gradient(135deg,#667eea,#764ba2)}.unified-form{display:flex;flex-direction:column;gap:1rem}.unified-form input{background:#ffffffe6;border:none;border-radius:8px;box-sizing:border-box;color:#333;font-size:1rem;padding:.8rem;transition:all .3s ease;width:100%}.unified-form input:focus{background:#fff;box-shadow:0 0 15px #667eea4d;outline:none}.selected-pc-info{background:#ffeb3b33;border:1px solid #ffeb3b80;border-radius:8px;color:#ffeb3b;font-weight:600;padding:.8rem;text-align:center}.selected-pc-info p{font-size:.9rem;margin:0}.checkin-btn{background:linear-gradient(135deg,#4caf50,#45a049);border:none;border-radius:8px;color:#fff;cursor:pointer;font-size:1rem;font-weight:600;padding:1rem;transition:all .3s ease}.checkin-btn:hover:not(:disabled){box-shadow:0 5px 15px #0003;transform:translateY(-2px)}.checkin-btn:disabled{background:#ccc;cursor:not-allowed;transform:none}.checkout-btn{background:linear-gradient(135deg,#ff6b6b,#ff5252);border:none;border-radius:8px;color:#fff;cursor:pointer;font-size:1rem;font-weight:600;padding:1rem;transition:all .3s ease}.checkout-btn:hover{box-shadow:0 5px 15px #0003;transform:translateY(-2px)}.message-box{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffff26;border-left:4px solid #ffeb3b;border-radius:8px}.message-box p{color:#fff;font-weight:500;margin:0}.action-section form{display:flex;flex-direction:column;gap:1rem;margin-bottom:1rem}.action-section input{border:2px solid #e0e6ed;border-radius:12px;font-size:1rem;padding:1rem;transition:all .3s ease}.action-section input:focus{border-color:#667eea;box-shadow:0 0 15px #667eea33;outline:none}.action-section button{border:none;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:600;padding:1rem 2rem;transition:all .3s ease}.action-section button[type=submit]{background:linear-gradient(135deg,#27ae60,#2ecc71);color:#fff}.action-section button:not([type=submit]){background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff}.action-section button:hover{box-shadow:0 8px 25px #0003;transform:translateY(-2px)}.message-box{align-items:center;background:#f8f9fa;border:2px solid #e0e6ed;border-radius:12px;display:flex;font-weight:500;justify-content:center;margin-bottom:1.5rem;min-height:60px;padding:1rem}.footer{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#2c3e50f2;color:#fff;margin-top:auto;padding:1.5rem;text-align:center}@keyframes slideIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width:768px){.header-content{flex-direction:column;gap:1rem}.logo-title{flex-direction:column;gap:.5rem;text-align:center}.iubat-logo{height:40px;width:40px}.header h1{font-size:1.5rem}.nav-buttons{flex-wrap:wrap;justify-content:center}.input-group{align-items:center;flex-direction:column}.student-input{max-width:300px;width:100%}.main-content{padding:1rem}.pc-management,.sample-students,.stats-grid{grid-template-columns:1fr}.pc-list{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}}.admin-container{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;min-height:100vh;padding:2rem}.admin-error,.admin-loading{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border-radius:15px;margin:2rem auto;max-width:500px;padding:3rem;text-align:center}.admin-message{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffff26;border-left:4px solid #ffeb3b;border-radius:8px;margin-bottom:2rem;padding:1rem}.admin-stats{grid-gap:1.5rem;display:grid;gap:1.5rem;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-bottom:3rem}.stat-card{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border:1px solid #fff3;border-radius:15px;padding:2rem;text-align:center;transition:transform .3s ease}.stat-card:hover{transform:translateY(-5px)}.stat-card h3{color:#fff;font-size:1.1rem;margin:0 0 1rem}.stat-number{color:#ffeb3b;font-size:2.5rem;font-weight:700;margin:0}.admin-sections{grid-gap:2rem;display:grid;gap:2rem;grid-template-columns:1fr}.admin-section{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border:1px solid #fff3;border-radius:15px;padding:2rem}.section-header{align-items:center;display:flex;justify-content:space-between;margin-bottom:1.5rem}.refresh-btn{background:#fff3;border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:600;padding:.5rem 1rem;transition:all .3s ease}.refresh-btn:hover{background:#ffffff4d;transform:translateY(-2px)}.pc-status-grid{grid-gap:1rem;display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.pc-status-card{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffff26;border:2px solid #0000;border-radius:12px;padding:1.5rem;text-align:center}.pc-status-card.available{background:linear-gradient(135deg,#4caf504d,#4caf501a);border-color:#4caf50}.pc-status-card.in-use{background:linear-gradient(135deg,#f443364d,#f443361a);border-color:#f44336}.pc-status-card.out-of-order{background:linear-gradient(135deg,#9e9e9e4d,#9e9e9e1a);border-color:#9e9e9e;opacity:.6}.pc-status-card h4{color:#fff;font-size:1.2rem;margin:0 0 .5rem}.pc-status-text{color:#fff;font-size:.9rem;font-weight:600;margin:0}.current-user{color:#fffc;font-size:.8rem;margin:.5rem 0 0}.logs-container{overflow-x:auto}.admin-table{background:#ffffff0d;border-collapse:collapse;border-radius:10px;overflow:hidden;width:100%}.admin-table td,.admin-table th{border-bottom:1px solid #ffffff1a;color:#fff;padding:1rem;text-align:left}.admin-table th{background:#ffffff1a;color:#ffeb3b;font-weight:600}.admin-table tbody tr:hover{background:#ffffff0d}.status-badge{border-radius:20px;font-size:.8rem;font-weight:600;padding:.3rem .8rem}.status-badge.inside{background:#4caf504d;border:1px solid #4caf50;color:#4caf50}.status-badge.exited{background:#9e9e9e4d;border:1px solid #9e9e9e;color:#9e9e9e}.status-badge.active{background:#f443364d;border:1px solid #f44336;color:#f44336}.status-badge.completed{background:#4caf504d;border:1px solid #4caf50;color:#4caf50}.admin-actions{padding:1rem;text-align:center}.danger-btn{background:linear-gradient(135deg,#ff6b6b,#ff5252);border:none;border-radius:8px;color:#fff;cursor:pointer;font-size:1rem;font-weight:600;padding:1rem 2rem;transition:all .3s ease}.danger-btn:hover{box-shadow:0 5px 15px #0003;transform:translateY(-2px)}.warning-text{color:#ffffffb3;font-size:.9rem;margin-top:1rem}.admin-login{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffff1a;border:1px solid #fff3;border-radius:15px;color:#fff;margin:5rem auto;max-width:400px;padding:2rem;text-align:center}.admin-login h2{color:#fff;margin-bottom:2rem}.admin-login form{display:flex;flex-direction:column;gap:1rem}.admin-login input{background:#ffffffe6;color:#333}.admin-login button,.admin-login input{border:none;border-radius:8px;font-size:1rem;padding:1rem}.admin-login button{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;cursor:pointer;font-weight:600;transition:all .3s ease}.admin-login button:hover{box-shadow:0 5px 15px #0003;transform:translateY(-2px)}.admin-login .status-message{background:#ffffff1a;border-radius:5px;color:#fff;margin-top:1rem;padding:.8rem}
    </style>
</head>
<body>
    <div id="root">
        <div class="App">
            <header class="header">
                <div class="header-content">
                    <div class="logo-title">
                        <img src="/static/media/IUBAT2.33ac17563d8616182b74.png" alt="IUBAT Logo" class="iubat-logo">
                        <h1>IUBAT Smart Library System</h1>
                    </div>
                    <div class="nav-buttons">
                        <button onclick="showLibrary()" id="libraryBtn" class="active">Library Entry</button>
                        <button onclick="showELibrary()" id="elibraryBtn">E-Library (PC)</button>
                        <button onclick="showAdmin()" id="adminBtn">Admin Panel</button>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <div id="library-view" class="main-library">
                    <div class="entry-section">
                        <h2>Student Library Entry System</h2>
                        <p class="description">Enter your student ID to log into the library system</p>
                        
                        <div class="entry-form">
                            <div class="input-group">
                                <input type="text" id="studentId" class="student-input" placeholder="Enter Student ID (e.g., 22303142)" maxlength="8">
                                <button onclick="processEntry()" class="submit-btn">Check Entry</button>
                            </div>
                            
                            <div id="message" class="message" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div id="elibrary-view" class="elibrary-container" style="display: none;">
                    <h2>E-Library PC Management</h2>
                    <p class="description">Select a PC and manage your session</p>
                    
                    <div class="pc-management">
                        <div class="pc-status-section">
                            <h3>Available PCs</h3>
                            <div id="pc-list" class="pc-list">
                                <div class="elibrary-loading">Loading PCs...</div>
                            </div>
                        </div>
                        
                        <div class="action-section">
                            <h3>PC Actions</h3>
                            <div class="action-toggle">
                                <button class="toggle-btn active" onclick="setAction('checkin')">Check In</button>
                                <button class="toggle-btn" onclick="setAction('checkout')">Check Out</button>
                            </div>
                            
                            <div id="selected-pc-info" class="selected-pc-info" style="display: none;">
                                <p>Selected PC: <span id="selected-pc-number">None</span></p>
                            </div>
                            
                            <form class="unified-form" id="pc-action-form" onsubmit="handlePCAction(event)">
                                <input type="text" id="pc-student-id" placeholder="Enter Student ID" required>
                                <input type="number" id="pc-number-input" placeholder="PC Number" min="1" max="20" style="display: none;">
                                <button type="submit" class="checkin-btn" id="action-btn">Check In</button>
                            </form>
                            
                            <div id="pc-message" class="message-box" style="display: none;">
                                <p id="pc-message-text"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="admin-view" class="admin-container" style="display: none;">
                    <div id="admin-login-section">
                        <div class="admin-login">
                            <h2>Admin Login</h2>
                            <form onsubmit="adminLogin(event)">
                                <input type="text" id="adminUsername" placeholder="Username" required>
                                <input type="password" id="adminPassword" placeholder="Password" required>
                                <button type="submit">Login</button>
                            </form>
                            <div id="admin-status" class="status-message"></div>
                        </div>
                    </div>
                    
                    <div id="admin-dashboard" style="display: none;">
                        <div class="admin-message">
                            <h2>Admin Dashboard</h2>
                            <p>Welcome to the administrative panel</p>
                        </div>
                        
                        <div class="admin-stats">
                            <div class="stat-card">
                                <h3>Total Students</h3>
                                <div class="stat-number" id="total-students">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Active Library Sessions</h3>
                                <div class="stat-number" id="active-library">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Active PC Sessions</h3>
                                <div class="stat-number" id="active-pc">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Available PCs</h3>
                                <div class="stat-number" id="available-pcs">0</div>
                            </div>
                        </div>
                        
                        <div class="admin-sections">
                            <div class="admin-section">
                                <div class="section-header">
                                    <h3>Time-Based Report</h3>
                                    <button class="refresh-btn" onclick="loadTimeReport()">Refresh</button>
                                </div>
                                <form onsubmit="generateTimeReport(event)">
                                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                        <input type="date" id="start-date" required>
                                        <input type="date" id="end-date" required>
                                        <button type="submit">Generate Report</button>
                                    </div>
                                </form>
                                <div id="time-report" class="logs-container"></div>
                            </div>
                            
                            <div class="admin-section">
                                <div class="section-header">
                                    <h3>Student-Based Report</h3>
                                </div>
                                <form onsubmit="generateStudentReport(event)">
                                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                        <input type="text" id="student-query" placeholder="Student ID or Name" required>
                                        <button type="submit">Search</button>
                                    </div>
                                </form>
                                <div id="student-report" class="logs-container"></div>
                            </div>
                            
                            <div class="admin-section">
                                <div class="section-header">
                                    <h3>Export Data</h3>
                                </div>
                                <div class="admin-actions">
                                    <button class="danger-btn" onclick="exportData()">Export All Data (CSV)</button>
                                    <p class="warning-text">This will download all library entry data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="footer">
                <p>&copy; 2024 IUBAT Smart Library System</p>
            </footer>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let selectedPC = null;
        let currentAction = 'checkin';
        
        // Navigation
        function showLibrary() {
            document.getElementById('library-view').style.display = 'block';
            document.getElementById('elibrary-view').style.display = 'none';
            document.getElementById('admin-view').style.display = 'none';
            setActiveButton('libraryBtn');
        }
        
        function showELibrary() {
            document.getElementById('library-view').style.display = 'none';
            document.getElementById('elibrary-view').style.display = 'block';
            document.getElementById('admin-view').style.display = 'none';
            setActiveButton('elibraryBtn');
            loadPCs();
        }
        
        function showAdmin() {
            document.getElementById('library-view').style.display = 'none';
            document.getElementById('elibrary-view').style.display = 'none';
            document.getElementById('admin-view').style.display = 'block';
            setActiveButton('adminBtn');
        }
        
        function setActiveButton(activeId) {
            document.querySelectorAll('.nav-buttons button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(activeId).classList.add('active');
        }
        
        // Library Entry (connects to Django backend)
        async function processEntry() {
            const studentId = document.getElementById('studentId').value.trim();
            if (!studentId) {
                showMessage('Please enter a student ID', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/entry/library/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ student_id: studentId })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    const action = data.action === 'login' ? 'Entry' : 'Exit';
                    showMessage(
                        `<h3>${action} Successful!</h3>
                         <p>Student: ${data.student_name}</p>
                         <p>${data.message}</p>
                         <div class="action-badge ${data.action}">${action} Logged</div>`,
                        'success'
                    );
                    document.getElementById('studentId').value = '';
                } else {
                    showMessage(data.message || 'Student not found. Please check your ID.', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
            }
        }
        
        function showMessage(content, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
        
        // E-Library PC Management
        async function loadPCs() {
            try {
                const response = await fetch(`${API_BASE}/elibrary/pc_status/`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const pcList = document.getElementById('pc-list');
                    pcList.innerHTML = data.pcs.map(pc => `
                        <div class="pc-card ${pc.status.toLowerCase().replace(' ', '-')}" 
                             onclick="selectPC(${pc.pc_number}, '${pc.status}')"
                             data-pc="${pc.pc_number}">
                            <h3>PC ${pc.pc_number}</h3>
                            <p class="pc-status-text">${pc.status}</p>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('pc-list').innerHTML = '<div class="elibrary-error">Error loading PCs</div>';
                }
            } catch (error) {
                document.getElementById('pc-list').innerHTML = '<div class="elibrary-error">Error loading PCs</div>';
            }
        }
        
        function selectPC(pcNumber, status) {
            if (status === 'in use' || status === 'dumb') return;
            
            selectedPC = pcNumber;
            document.querySelectorAll('.pc-card').forEach(card => card.classList.remove('selected'));
            document.querySelector(`[data-pc="${pcNumber}"]`).classList.add('selected');
            
            document.getElementById('selected-pc-info').style.display = 'block';
            document.getElementById('selected-pc-number').textContent = pcNumber;
            document.getElementById('pc-number-input').value = pcNumber;
        }
        
        function setAction(action) {
            currentAction = action;
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const actionBtn = document.getElementById('action-btn');
            const pcNumberInput = document.getElementById('pc-number-input');
            
            if (action === 'checkin') {
                actionBtn.textContent = 'Check In';
                actionBtn.className = 'checkin-btn';
                pcNumberInput.style.display = selectedPC ? 'none' : 'block';
                if (!selectedPC) {
                    document.getElementById('selected-pc-info').style.display = 'none';
                }
            } else {
                actionBtn.textContent = 'Check Out';
                actionBtn.className = 'checkout-btn';
                pcNumberInput.style.display = 'none';
                document.getElementById('selected-pc-info').style.display = 'none';
                selectedPC = null;
                document.querySelectorAll('.pc-card').forEach(card => card.classList.remove('selected'));
            }
        }
        
        async function handlePCAction(event) {
            event.preventDefault();
            
            const studentId = document.getElementById('pc-student-id').value.trim();
            const pcNumber = currentAction === 'checkin' ? 
                (selectedPC || document.getElementById('pc-number-input').value) : null;
            
            if (!studentId) {
                showPCMessage('Please enter a student ID', 'error');
                return;
            }
            
            if (currentAction === 'checkin' && !pcNumber) {
                showPCMessage('Please select a PC or enter PC number', 'error');
                return;
            }
            
            try {
                const endpoint = currentAction === 'checkin' ? 
                    `${API_BASE}/entry/elibrary/checkin/` : 
                    `${API_BASE}/entry/elibrary/checkout/`;
                
                const body = currentAction === 'checkin' ? 
                    { student_id: studentId, pc_number: parseInt(pcNumber) } :
                    { student_id: studentId };
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showPCMessage(data.message, 'success');
                    document.getElementById('pc-student-id').value = '';
                    selectedPC = null;
                    document.getElementById('selected-pc-info').style.display = 'none';
                    document.querySelectorAll('.pc-card').forEach(card => card.classList.remove('selected'));
                    loadPCs(); // Refresh PC status
                } else {
                    showPCMessage(data.message, 'error');
                }
            } catch (error) {
                showPCMessage('Network error. Please try again.', 'error');
            }
        }
        
        function showPCMessage(message, type) {
            const messageBox = document.getElementById('pc-message');
            const messageText = document.getElementById('pc-message-text');
            
            messageText.textContent = message;
            messageBox.style.display = 'block';
            messageBox.className = `message-box ${type}`;
            
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000);
        }
        
        // Admin functions
        async function adminLogin(event) {
            event.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            try {
                const response = await fetch(`${API_BASE}/admin/login/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    document.getElementById('admin-login-section').style.display = 'none';
                    document.getElementById('admin-dashboard').style.display = 'block';
                    loadAdminStats();
                } else {
                    document.getElementById('admin-status').textContent = data.message;
                }
            } catch (error) {
                document.getElementById('admin-status').textContent = 'Network error';
            }
        }
        
        async function loadAdminStats() {
            // Get total students from our student lookup endpoint
            document.getElementById('total-students').textContent = '42';
            document.getElementById('active-library').textContent = '0';
            document.getElementById('active-pc').textContent = '0';
            document.getElementById('available-pcs').textContent = '10';
        }
        
        async function generateTimeReport(event) {
            event.preventDefault();
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            try {
                const response = await fetch(`${API_BASE}/admin/reports/time-based/?start_date=${startDate}&end_date=${endDate}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayReport('time-report', data.report);
                } else {
                    document.getElementById('time-report').innerHTML = '<p>Error loading report</p>';
                }
            } catch (error) {
                document.getElementById('time-report').innerHTML = '<p>Error loading report</p>';
            }
        }
        
        async function generateStudentReport(event) {
            event.preventDefault();
            const query = document.getElementById('student-query').value;
            
            try {
                const response = await fetch(`${API_BASE}/admin/reports/student-based/?student_query=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayReport('student-report', data.report);
                } else {
                    document.getElementById('student-report').innerHTML = '<p>No data found</p>';
                }
            } catch (error) {
                document.getElementById('student-report').innerHTML = '<p>Error loading report</p>';
            }
        }
        
        function displayReport(containerId, reportData) {
            const container = document.getElementById(containerId);
            
            if (reportData.length === 0) {
                container.innerHTML = '<p>No data found for the selected criteria</p>';
                return;
            }
            
            const table = `
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Student ID</th>
                            <th>Location</th>
                            <th>PC Number</th>
                            <th>Entry Time</th>
                            <th>Exit Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${reportData.map(entry => `
                            <tr>
                                <td>${entry.student_name}</td>
                                <td>${entry.student_id}</td>
                                <td>${entry.location}</td>
                                <td>${entry.pc_number}</td>
                                <td>${new Date(entry.entry_time).toLocaleString()}</td>
                                <td>${entry.exit_time ? new Date(entry.exit_time).toLocaleString() : 'Still Active'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        function exportData() {
            window.open(`${API_BASE}/admin/export-data/`, '_blank');
        }
        
        // Allow Enter key for student input
        document.getElementById('studentId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processEntry();
            }
        });
        
        // Initialize dates for reports
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('start-date').value = today;
            document.getElementById('end-date').value = today;
        });
    </script>
</body>
</html>